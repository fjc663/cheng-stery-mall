import{u as M}from"./useCart-COOFCTo-.js";import{d as Q,e as _,C as A,i as L,h as f,a,w as l,F as y,x as j,r as n,o as g,b as r,f as u,u as G,t as d,l as H,D as K,g as I,_ as W}from"./index-CMV7StrB.js";import"./useCartItemsNumStore-BpwacNS2.js";import"./http-Bo0dlXKR.js";import"./axios-BimPEqV4.js";const X={class:"dialog-footer"},Y={class:"cart-summary"},Z={class:"cart-total"},ee=Q({__name:"CartView",setup(te){const{cartItems:C,getCartItems:V,deleteAllCart:k,deleteCart:x,updateCartItemQuantity:N}=M(),m=_([]),q=A(()=>m.value.reduce((o,e)=>o+e.productPrice*e.quantity,0)),S=async o=>{N(o)},B=o=>{x(o)},i=_(!1),F=()=>{k(),i.value=!1},O=()=>{if(m.value.length===0){K.warning("请至少选择一件商品进行结算");return}const o=m.value.map(e=>e.id);I.push({path:"/order",query:{selectedItems:JSON.stringify(o)}})},b=_(),v=j(),P=v.query.selectedCartIds?JSON.parse(v.query.selectedCartIds):[];L(async()=>{await V(),C.value.forEach(o=>{var e;P.includes(o.id)&&((e=b.value)==null||e.toggleRowSelection(o,!0))})});const R=()=>{I.back()};return(o,e)=>{const c=n("el-button"),T=n("el-dialog"),U=n("el-page-header"),$=n("el-header"),s=n("el-table-column"),D=n("el-image"),E=n("el-input-number"),J=n("el-table"),h=n("el-main"),z=n("el-container");return g(),f(y,null,[a(T,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),title:"温馨提示",width:"500"},{footer:l(()=>[r("div",X,[a(c,{onClick:e[0]||(e[0]=t=>i.value=!1)},{default:l(()=>e[4]||(e[4]=[u("取消")])),_:1}),a(c,{type:"primary",onClick:F},{default:l(()=>e[5]||(e[5]=[u(" 确定 ")])),_:1})])]),default:l(()=>[e[6]||(e[6]=r("span",null,"您确定要清空购物车吗？",-1))]),_:1},8,["modelValue"]),a(z,{class:"cart-page"},{default:l(()=>[a($,null,{default:l(()=>[a(U,{onBack:R}),e[7]||(e[7]=r("h1",{class:"cart-title"},"购物车",-1))]),_:1}),a(h,null,{default:l(()=>[a(J,{data:G(C),stripe:"",border:"",onSelectionChange:e[2]||(e[2]=t=>m.value=t),ref_key:"cartTableRef",ref:b},{default:l(()=>[a(s,{type:"selection",width:"50",align:"center"}),a(s,{label:"商品图片",width:"120"},{default:l(t=>[a(D,{src:t.row.productImageUrl,class:"product-image",fit:"cover"},null,8,["src"])]),_:1}),a(s,{prop:"productName",label:"商品名称"},{default:l(t=>[r("span",null,d(t.row.productName),1)]),_:1}),a(s,{label:"商品规格"},{default:l(t=>[(g(!0),f(y,null,H(JSON.parse(t.row.specifications),(p,w)=>(g(),f("div",{key:w},[r("strong",null,d(w)+":",1),u(" "+d(p),1)]))),128))]),_:1}),a(s,{prop:"productPrice",label:"单价"},{default:l(t=>[r("span",null,"￥"+d(t.row.productPrice),1)]),_:1}),a(s,{label:"数量"},{default:l(t=>[a(E,{modelValue:t.row.quantity,"onUpdate:modelValue":p=>t.row.quantity=p,min:1,onChange:p=>S(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(s,{label:"小计",width:"100"},{default:l(t=>[r("span",null,"￥"+d((t.row.productPrice*t.row.quantity).toFixed(2)),1)]),_:1}),a(s,{label:"操作",width:"100"},{default:l(t=>[a(c,{type:"danger",onClick:p=>B(t.row)},{default:l(()=>e[8]||(e[8]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),r("div",Y,[r("span",Z,"总计：￥"+d(q.value.toFixed(2)),1),a(c,{type:"primary",size:"large",class:"checkout-btn",onClick:O},{default:l(()=>e[9]||(e[9]=[u("去结算")])),_:1}),a(c,{type:"danger",size:"large",onClick:e[3]||(e[3]=t=>i.value=!0),class:"clear-cart-btn"},{default:l(()=>e[10]||(e[10]=[u("清空购物车")])),_:1})])]),_:1})]),_:1})],64)}}}),se=W(ee,[["__scopeId","data-v-9a472c61"]]);export{se as default};
