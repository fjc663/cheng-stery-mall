import{u as ne}from"./useCategory-DUTDZwFS.js";import{u as se}from"./useUpload-DJmHiEKQ.js";import{d as re,e as g,i as ue,h as F,a as e,w as t,b as f,u as P,r as s,o as k,f as i,t as C,c as j,z as de,H as ie,D as V,_ as pe}from"./index-CMV7StrB.js";import"./http-Bo0dlXKR.js";import"./axios-BimPEqV4.js";import"./httpAdmin-C6IWq_Ob.js";const me={class:"category-management"},ce={class:"search-controls"},ge={class:"sub-category",style:{margin:"20px 100px"}},fe={class:"add-subCategory-btn"},ve={class:"product-pagination-block"},_e=["src"],ye={class:"dialog-footer"},be=re({__name:"CategoryView",setup(we){const{allCategories:Q,totalCategory:q,pageQueryCategoryDTO:m,pageQueryCategory:c,editCategory:z,addCategory:H,deleteCategory:I}=ne(),x=g(1),U=g(10),W=n=>{m.value.pageSize=n,c()},G=n=>{m.value.page=n,c()},o=g({id:null,name:"",description:"",imageUrl:"",status:1,sortOrder:1}),v=g(!1),_=g(!0),y=g(!1),O=n=>{o.value={id:null,name:"",description:"",imageUrl:"",status:0,sortOrder:1,parentId:n},n?y.value=!0:y.value=!1,_.value=!0,v.value=!0},$=n=>{Object.assign(o.value,n),_.value=!1,n.parentId?y.value=!0:y.value=!1,v.value=!0},B=n=>{ie.confirm("此操作将永久删除该分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await I(n),c()}).catch(()=>{V({type:"info",message:"已取消删除"})})},J=async()=>{if(!o.value.name){V.error("分类名称不能为空");return}if(o.value.name.length<1||o.value.name.length>20){V.error("分类名称字符长度为1到20");return}v.value=!1,_.value?await H(o.value):await z(o.value),c()},S=async(n,l)=>{o.value={id:n,status:l},await z(o.value),c()},p=g({name:"",status:-1}),D=()=>{m.value.name=p.value.name,p.value.status===0||p.value.status===1?m.value.status=p.value.status:m.value.status=null,c()};ue(()=>{m.value.page=x.value,m.value.pageSize=U.value,c()});const{uploadCategory:K}=se(),L=async n=>{const l=new FormData;l.append("categoryFile",n.file);const r=await K(l);r.code===1&&(o.value.imageUrl=r.data)},R=n=>n.size/1024/1024>10?(V.error("头像大小必须小于10MB"),!1):!0;return(n,l)=>{const r=s("el-button"),h=s("el-input"),b=s("el-option"),E=s("el-select"),M=s("el-card"),u=s("el-table-column"),X=s("el-image"),N=s("el-tag"),T=s("el-table"),Y=s("el-pagination"),w=s("el-form-item"),Z=s("Plus"),ee=s("el-icon"),le=s("el-upload"),ae=s("el-input-number"),te=s("el-form"),oe=s("el-dialog");return k(),F("div",me,[e(M,{class:"search-card",shadow:"hover"},{default:t(()=>[f("div",ce,[e(h,{modelValue:p.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>p.value.name=a),placeholder:"请输入分类名称",clearable:"",class:"search-input"},{append:t(()=>[e(r,{onClick:D},{default:t(()=>l[11]||(l[11]=[f("svg",{class:"icon","aria-hidden":"true"},[f("use",{"xlink:href":"#icon-find"})],-1)])),_:1})]),_:1},8,["modelValue"]),e(E,{modelValue:p.value.status,"onUpdate:modelValue":l[1]||(l[1]=a=>p.value.status=a),onChange:D,placeholder:"请选择分类状态",clearable:"",class:"status-select"},{default:t(()=>[e(b,{label:"全部",value:-1}),e(b,{label:"启用",value:1}),e(b,{label:"禁用",value:0})]),_:1},8,["modelValue"]),e(r,{class:"add-category-btn",type:"primary",plain:"",onClick:l[2]||(l[2]=a=>O(null))},{default:t(()=>l[12]||(l[12]=[i(" 添加分类 ")])),_:1})])]),_:1}),e(M,{class:"category-card",shadow:"hover",style:{"margin-top":"20px"}},{default:t(()=>[e(T,{data:P(Q),border:"",stripe:"","header-cell-style":{"text-align":"center","background-color":"#f7f8fa","font-weight":"bold"},"cell-style":{"text-align":"center"},style:{width:"100%"},"default-sort":{prop:"sortOrder",order:"ascending"}},{default:t(()=>[e(u,{type:"index",label:"序号",width:"60"}),e(u,{prop:"imageUrl",label:"分类图片",width:"150"},{default:t(a=>[e(X,{src:a.row.imageUrl,fit:"cover",class:"image-thumbnail"},null,8,["src"])]),_:1}),e(u,{prop:"name",label:"分类名称"}),e(u,{prop:"description",label:"描述"}),e(u,{prop:"status",label:"状态",width:"100"},{default:t(a=>[e(N,{type:a.row.status===1?"success":"danger"},{default:t(()=>[i(C(a.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"sortOrder",sortable:"",label:"排序",width:"80"}),e(u,{label:"操作",width:"200"},{default:t(a=>[e(r,{type:a.row.status===1?"danger":"success",size:"small",link:"",onClick:d=>S(a.row.id,a.row.status===1?0:1)},{default:t(()=>[i(C(a.row.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(r,{size:"small",type:"primary",onClick:d=>$(a.row),link:""},{default:t(()=>l[13]||(l[13]=[i("编辑")])),_:2},1032,["onClick"]),e(r,{size:"small",type:"danger",onClick:d=>B(a.row.id),link:""},{default:t(()=>l[14]||(l[14]=[i("删除")])),_:2},1032,["onClick"])]),_:1}),e(u,{label:"子分类",type:"expand",width:"80"},{default:t(a=>[f("div",ge,[f("div",fe,[e(r,{type:"primary",plain:"",onClick:d=>O(a.row.id)},{default:t(()=>l[15]||(l[15]=[i(" 添加 ")])),_:2},1032,["onClick"])]),e(T,{data:a.row.subCategories,border:"","header-cell-style":{"text-align":"center",background:"#fafafa",fontWeight:"bold"},"cell-style":{"text-align":"center"},"default-sort":{prop:"sortOrder",order:"ascending"}},{default:t(()=>[e(u,{type:"index",label:"序号",width:"60"}),e(u,{label:a.row.name+"的二级分类",prop:"name"},null,8,["label"]),e(u,{label:"描述",prop:"description"}),e(u,{prop:"status",label:"状态",width:"100"},{default:t(d=>[e(N,{type:d.row.status===1?"success":"danger"},{default:t(()=>[i(C(d.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"sortOrder",sortable:"",label:"排序",width:"80"}),e(u,{label:"操作",width:"200"},{default:t(d=>[e(r,{type:d.row.status===1?"danger":"success",size:"small",link:"",onClick:A=>S(d.row.id,d.row.status===1?0:1)},{default:t(()=>[i(C(d.row.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),e(r,{size:"small",type:"primary",onClick:A=>$(d.row),link:""},{default:t(()=>l[16]||(l[16]=[i("编辑")])),_:2},1032,["onClick"]),e(r,{size:"small",type:"danger",onClick:A=>B(d.row.id),link:""},{default:t(()=>l[17]||(l[17]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])])]),_:1})]),_:1},8,["data"])]),_:1}),f("div",ve,[e(Y,{"current-page":x.value,"onUpdate:currentPage":l[3]||(l[3]=a=>x.value=a),"page-size":U.value,"onUpdate:pageSize":l[4]||(l[4]=a=>U.value=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:P(q),onSizeChange:W,onCurrentChange:G},null,8,["current-page","page-size","total"])]),e(oe,{modelValue:v.value,"onUpdate:modelValue":l[10]||(l[10]=a=>v.value=a),draggable:"",width:"500px",title:_.value?"添加分类":"修改分类"},{default:t(()=>[e(te,{model:o.value,"label-width":"80px",class:"category-form"},{default:t(()=>[e(w,{label:"名称"},{default:t(()=>[e(h,{modelValue:o.value.name,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.name=a),placeholder:"请输入分类名称",class:"form-input"},null,8,["modelValue"])]),_:1}),e(w,{label:"描述"},{default:t(()=>[e(h,{modelValue:o.value.description,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.description=a),type:"textarea",placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),y.value?de("",!0):(k(),j(w,{key:0,label:"分类图片"},{default:t(()=>[e(le,{class:"category-uploader","http-request":L,"show-file-list":!1,"before-upload":R},{default:t(()=>[o.value.imageUrl?(k(),F("img",{key:0,src:o.value.imageUrl,class:"uploaded-image"},null,8,_e)):(k(),j(ee,{key:1,class:"category-uploader-icon"},{default:t(()=>[e(Z)]),_:1}))]),_:1})]),_:1})),e(w,{label:"状态"},{default:t(()=>[e(E,{modelValue:o.value.status,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.status=a),placeholder:"请选择状态",class:"form-select"},{default:t(()=>[e(b,{label:"启用",value:1}),e(b,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"排序"},{default:t(()=>[e(ae,{modelValue:o.value.sortOrder,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.sortOrder=a),min:0,label:"排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),f("div",ye,[e(r,{onClick:l[9]||(l[9]=a=>v.value=!1)},{default:t(()=>l[18]||(l[18]=[i("取消")])),_:1}),e(r,{type:"primary",onClick:J},{default:t(()=>[i(C(_.value?"添加":"修改"),1)]),_:1})])]),_:1},8,["modelValue","title"])])}}}),ze=pe(be,[["__scopeId","data-v-c84d7757"]]);export{ze as default};
