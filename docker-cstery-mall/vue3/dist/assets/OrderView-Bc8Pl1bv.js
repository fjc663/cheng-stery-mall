import{u as oe}from"./useCart-COOFCTo-.js";import{u as ae}from"./useOrder-mXwGJRjg.js";import{u as re}from"./useCartItemsNumStore-BpwacNS2.js";import{d as ne,g as O,e as d,i as S,C as ue,h as N,a as s,w as o,F as I,x as de,r,o as f,b as l,l as F,c as ie,t as a,f as i,u as B,_ as me}from"./index-CMV7StrB.js";import{u as pe}from"./useAddress-fWOuFEY4.js";import{b as ce}from"./element-china-area-data-BVDNhPol.js";import"./http-Bo0dlXKR.js";import"./axios-BimPEqV4.js";import"./httpAdmin-C6IWq_Ob.js";const ve={class:"address-section"},fe={class:"address-content"},_e={class:"order-items-section"},ge={class:"remark-section"},ye={class:"order-summary-section"},Ve={class:"summary-item"},be={class:"summary-item"},Ae={class:"summary-item"},we={class:"summary-item total-amount"},Ne={class:"payment-section"},xe={class:"submit-section"},Ie={class:"dialog-footer"},ke=ne({__name:"OrderView",setup(Ce){const k=re();k.cartItemsNum===0&&O.push("/");const _=d(1),{addresses:C,getAddress:M,addNewAddress:$}=pe(),P=async()=>{await M(),C.value.forEach(u=>{if(u.isDefault){_.value=u.id||-1;return}})};S(()=>P());const g=d([]),R=d({receiverName:[{required:!0,message:"请输入用户名",trigger:"blur"},{max:50,message:"收货人名字字符长度最大为50",trigger:"blur"}],receiverPhone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{min:11,max:11,message:"请输入11位手机号码",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"请输入正确的手机号码"}],detailedAddress:[{required:!0,message:"请输入详细地址",trigger:"blur"}]}),D=d(),c=d(!1),n=d({receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailedAddress:"",isDefault:!1}),z=()=>{n.value={receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailedAddress:"",isDefault:!1},g.value=[],c.value=!0},J=u=>{u&&u.validate(async e=>{e&&([n.value.province,n.value.city,n.value.district]=g.value,await $(n.value),P(),c.value=!1)})},E=de(),y=d([]),x=d([]),{cartItems:L,getCartItems:T}=oe();S(async()=>{await T();const u=E.query.selectedItems;u&&(y.value=JSON.parse(u),console.log("选中的商品 ID:",y.value)),x.value=L.value.filter(e=>y.value.includes(e.id))});const j=d(0),G=d(0),V=ue(()=>x.value.reduce((u,e)=>u+e.productPrice*e.quantity,0)),m=d({totalAmount:V.value,paymentMethod:1,addressId:0,remark:"",selectedCardId:[]}),{submitOrder:H}=ae(),K=async()=>{m.value.addressId=_.value,m.value.totalAmount=V.value,m.value.selectedCardId=y.value;const u=await H(m.value);u.code===1&&O.push(`/pay/${u.data}`),k.getCartItemsNum()};return(u,e)=>{const Q=r("el-header"),b=r("el-radio"),U=r("el-radio-group"),A=r("el-button"),W=r("el-image"),p=r("el-table-column"),X=r("el-table"),w=r("el-input"),Y=r("el-main"),Z=r("el-container"),v=r("el-form-item"),h=r("el-cascader"),ee=r("el-checkbox"),te=r("el-form"),le=r("el-dialog");return f(),N(I,null,[s(Z,{class:"checkout-page"},{default:o(()=>[s(Q,null,{default:o(()=>e[11]||(e[11]=[l("div",{class:"checkout-header"},[l("h1",{class:"checkout-title"},"确认订单")],-1)])),_:1}),s(Y,null,{default:o(()=>[l("section",ve,[e[13]||(e[13]=l("h2",{class:"section-title"},"收货地址",-1)),s(U,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),class:"address-list"},{default:o(()=>[(f(!0),N(I,null,F(B(C),t=>(f(),ie(b,{value:t.id,key:t.id,class:"address-item"},{default:o(()=>[l("div",fe,[l("p",null,[l("strong",null,a(t.receiverName),1),i(" "+a(t.receiverPhone),1)]),l("p",null,a(t.province)+" "+a(t.city)+" "+a(t.district)+" "+a(t.detailedAddress),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(A,{type:"primary",onClick:z,style:{"margin-left":"10px"},size:"small",plain:""},{default:o(()=>e[12]||(e[12]=[i("添加新地址")])),_:1})]),l("section",_e,[e[14]||(e[14]=l("h2",{class:"section-title"},"订单商品",-1)),s(X,{data:x.value,border:"",stripe:""},{default:o(()=>[s(p,{label:"商品图片",width:"120"},{default:o(t=>[s(W,{src:t.row.productImageUrl,class:"product-image",fit:"cover"},null,8,["src"])]),_:1}),s(p,{prop:"productName",label:"商品名称"},{default:o(t=>[l("span",null,a(t.row.productName),1)]),_:1}),s(p,{label:"规格"},{default:o(t=>[(f(!0),N(I,null,F(JSON.parse(t.row.specifications),(se,q)=>(f(),N("div",{key:q},[l("strong",null,a(q)+":",1),i(" "+a(se),1)]))),128))]),_:1}),s(p,{prop:"quantity",label:"数量"},{default:o(t=>[l("span",null,a(t.row.quantity),1)]),_:1}),s(p,{prop:"unitPrice",label:"单价"},{default:o(t=>[l("span",null,"￥"+a(t.row.productPrice),1)]),_:1}),s(p,{label:"小计"},{default:o(t=>[l("span",null,"￥"+a((t.row.productPrice*t.row.quantity).toFixed(2)),1)]),_:1})]),_:1},8,["data"])]),l("section",ge,[e[15]||(e[15]=l("h2",{class:"section-title"},"订单备注",-1)),s(w,{modelValue:m.value.remark,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value.remark=t),type:"textarea",placeholder:"例如：尽量发顺丰快递..."},null,8,["modelValue"])]),l("section",ye,[e[20]||(e[20]=l("h2",{class:"section-title"},"订单金额明细",-1)),l("div",Ve,[e[16]||(e[16]=l("span",null,"商品总金额：",-1)),l("span",null,"￥"+a(V.value.toFixed(2)),1)]),l("div",be,[e[17]||(e[17]=l("span",null,"运费：",-1)),l("span",null,"￥"+a(j.value.toFixed(2)),1)]),l("div",Ae,[e[18]||(e[18]=l("span",null,"优惠金额：",-1)),l("span",null,"-￥"+a(G.value.toFixed(2)),1)]),l("div",we,[e[19]||(e[19]=l("strong",null,"应付总额：",-1)),l("strong",null,"￥"+a(V.value.toFixed(2)),1)])]),l("section",Ne,[e[24]||(e[24]=l("h2",{class:"section-title"},"选择支付方式",-1)),s(U,{modelValue:m.value.paymentMethod,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value.paymentMethod=t)},{default:o(()=>[s(b,{value:1},{default:o(()=>e[21]||(e[21]=[i("支付宝")])),_:1}),s(b,{value:2},{default:o(()=>e[22]||(e[22]=[i("微信支付")])),_:1}),s(b,{value:3},{default:o(()=>e[23]||(e[23]=[i("信用卡支付")])),_:1})]),_:1},8,["modelValue"])]),l("section",xe,[s(A,{type:"primary",size:"large",onClick:K},{default:o(()=>e[25]||(e[25]=[i("去支付")])),_:1})])]),_:1})]),_:1}),s(le,{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=t),title:"地址信息",width:"500px"},{default:o(()=>[s(te,{model:n.value,"label-width":"100px",rules:R.value,ref_key:"currentAddressRef",ref:D},{default:o(()=>[s(v,{label:"收货人",prop:"receiverName"},{default:o(()=>[s(w,{modelValue:n.value.receiverName,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.receiverName=t),placeholder:"请输入收货人姓名"},null,8,["modelValue"])]),_:1}),s(v,{label:"联系电话",prop:"receiverPhone"},{default:o(()=>[s(w,{modelValue:n.value.receiverPhone,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.receiverPhone=t),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),s(v,{label:"省/市/区"},{default:o(()=>[s(h,{options:B(ce),modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t)},null,8,["options","modelValue"])]),_:1}),s(v,{label:"详细地址",prop:"detailedAddress"},{default:o(()=>[s(w,{modelValue:n.value.detailedAddress,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.detailedAddress=t),placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1}),s(v,null,{default:o(()=>[s(ee,{modelValue:n.value.isDefault,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.isDefault=t)},{default:o(()=>e[26]||(e[26]=[i("设为默认地址")])),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),l("div",Ie,[s(A,{onClick:e[8]||(e[8]=t=>c.value=!1)},{default:o(()=>e[27]||(e[27]=[i("取消")])),_:1}),s(A,{type:"primary",onClick:e[9]||(e[9]=t=>J(D.value))},{default:o(()=>e[28]||(e[28]=[i(a("添加地址"))])),_:1})])]),_:1},8,["modelValue"])],64)}}}),$e=me(ke,[["__scopeId","data-v-a04399a4"]]);export{$e as default};
