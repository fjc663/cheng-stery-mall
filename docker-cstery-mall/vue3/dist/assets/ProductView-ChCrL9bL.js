import{u as ye}from"./useProduct-D_j9yIew.js";import{u as ke}from"./useCategory-DUTDZwFS.js";import{u as we}from"./useUpload-DJmHiEKQ.js";import{u as Ve}from"./useSpecification-CLfyhdqd.js";import{d as Ce,e as y,i as xe,c as v,w as a,r as s,o as d,b as r,a as t,h as V,l as I,u as x,F as h,f as g,t as z,H as Ue,D as j,_ as Pe}from"./index-CMV7StrB.js";import"./http-Bo0dlXKR.js";import"./axios-BimPEqV4.js";import"./httpAdmin-C6IWq_Ob.js";const Ie={class:"search-filter-section"},he={class:"header-action-buttons"},ze={class:"product-pagination-block"},Se=["src"],$e={class:"dialog-footer"},Be=Ce({__name:"ProductView",setup(Ae){const{subAllCategories:S,getAllSubCategory:H}=ke(),{allSpecList:L,getAllSepc:O}=Ve(),{adminPageQueryProduct:_,adminProducts:Q,totalProductAdmin:R,pageQueryAdmin:p,addProduct:W,editProduct:D,deleteProduct:G,setProductType:J,resetProductType:K}=ye(),$=y(1),B=y(20),i=y({name:"",categoryId:null,status:null,type:null}),k=y(!1),U=y(!1),o=y({id:null,name:"",description:"",imageUrl:"",price:0,status:0,stock:0,categoryId:null,sales:0,specIds:[]}),q=y(),X=y({name:[{required:!0,message:"商品名称不能为空",trigger:"blur"},{min:1,max:20,message:"商品名称长度应为 1 到 20 个字符",trigger:"blur"}],price:[{required:!0,message:"商品价格不能为空",trigger:"blur"}],stock:[{required:!0,message:"库存不能为空",trigger:"blur"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}]}),P=()=>{p.value.name=i.value.name,p.value.categoryId=i.value.categoryId,p.value.status=i.value.status,p.value.type=i.value.type,_()},Y=n=>{var e;U.value=!0,k.value=!0,Object.assign(o.value,n),o.value.specIds=(e=n.specifications)==null?void 0:e.map(u=>u.id).filter(u=>u!=null)},Z=()=>{U.value=!1,k.value=!0,o.value={id:null,name:"",description:"",price:0,stock:0,categoryId:null,status:0,imageUrl:"",sales:0,specIds:[]}},ee=n=>{n&&n.validate(async e=>{e&&(U.value?await D(o.value):await W(o.value),_(),k.value=!1)})},le=n=>{Ue.confirm("此操作将永久删除该商品, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await G(n),_()}).catch(()=>{j({type:"info",message:"已取消删除"})})},te=n=>{p.value.pageSize=n,_()},ae=n=>{p.value.page=n,_()},oe=n=>{const e=S.value.find(u=>u.id===n);return e?e.name:"未知分类"},ne=async(n,e)=>{o.value={id:n,status:e},await D(o.value),_()},{uploadProduct:ue}=we(),se=async n=>{const e=new FormData;e.append("productFile",n.file);const u=await ue(e);u.code===1&&(o.value.imageUrl=u.data)},re=n=>n.size/1024/1024>10?(j.error("头像大小必须小于10MB"),!1):!0,A=async(n,e)=>{await J(n,e),_()},F=async(n,e)=>{await K(n,e),_()};return xe(()=>{p.value.page=$.value,p.value.pageSize=B.value,p.value.name=i.value.name,p.value.categoryId=i.value.categoryId,p.value.status=i.value.status,p.value.type=i.value.type,_(),H(),O()}),(n,e)=>{const u=s("el-button"),T=s("el-input"),c=s("el-form-item"),b=s("el-option"),C=s("el-select"),N=s("el-form"),m=s("el-table-column"),de=s("el-image"),ie=s("el-tag"),w=s("el-tooltip"),pe=s("el-table"),ce=s("el-pagination"),me=s("Plus"),fe=s("el-icon"),ve=s("el-upload"),E=s("el-input-number"),M=s("el-radio"),ge=s("el-radio-group"),_e=s("el-dialog"),be=s("el-card");return d(),v(be,{class:"product-management",shadow:"hover"},{default:a(()=>[r("div",Ie,[t(N,{inline:!0,"label-width":"80px",class:"search-form"},{default:a(()=>[t(c,{label:"商品名称"},{default:a(()=>[t(T,{modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.name=l),placeholder:"请输入商品名称",clearable:"",class:"search-input"},{append:a(()=>[t(u,{onClick:P},{default:a(()=>e[16]||(e[16]=[r("svg",{class:"icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-find"})],-1)])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"商品分类",style:{width:"250px"}},{default:a(()=>[t(C,{modelValue:i.value.categoryId,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.categoryId=l),onChange:P,placeholder:"请选择分类",clearable:""},{default:a(()=>[(d(!0),V(h,null,I(x(S),l=>(d(),v(b,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"商品状态",style:{width:"200px"}},{default:a(()=>[t(C,{modelValue:i.value.status,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.status=l),onChange:P,placeholder:"请选择状态",clearable:""},{default:a(()=>[t(b,{label:"上架",value:1}),t(b,{label:"下架",value:0})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"商品类型",style:{width:"200px"}},{default:a(()=>[t(C,{modelValue:i.value.type,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.type=l),onChange:P,placeholder:"请选择类型",clearable:""},{default:a(()=>[t(b,{label:"轮播图商品",value:1}),t(b,{label:"热门商品",value:2}),t(b,{label:"新品",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1}),r("div",he,[t(u,{type:"success",plain:"",onClick:Z},{default:a(()=>e[17]||(e[17]=[g("添加商品")])),_:1})])]),t(pe,{data:x(Q),border:"",stripe:"",style:{width:"100%"},"header-cell-style":{"text-align":"center",background:"#fafafa",fontWeight:"bold"},"cell-style":{"text-align":"center"}},{default:a(()=>[t(m,{type:"index",label:"序号",width:"60"}),t(m,{prop:"imageUrl",label:"商品图片",width:"150"},{default:a(l=>[t(de,{src:l.row.imageUrl,fit:"cover",class:"image-thumbnail"},null,8,["src"])]),_:1}),t(m,{prop:"name",label:"商品名称",width:"180"}),t(m,{prop:"description",label:"商品描述"}),t(m,{label:"商品规格",width:"180"},{default:a(l=>[(d(!0),V(h,null,I(l.row.specifications,f=>(d(),V("div",{key:f.id},z(f.name),1))),128))]),_:1}),t(m,{label:"分类",width:"180"},{default:a(l=>[g(z(oe(l.row.categoryId)),1)]),_:1}),t(m,{prop:"price",label:"价格",width:"100"}),t(m,{prop:"stock",label:"库存",width:"100"}),t(m,{prop:"sales",label:"销量",width:"100"}),t(m,{prop:"status",label:"状态",width:"80"},{default:a(l=>[t(ie,{type:l.row.status===1?"success":"danger"},{default:a(()=>[g(z(l.row.status===1?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"商品类型",width:"180"},{default:a(l=>[l.row.isSlides?(d(),v(w,{key:0,class:"box-item",effect:"dark",content:"取消作为轮播图商品",placement:"top"},{default:a(()=>[t(u,{onClick:f=>F(l.row.id,1),link:""},{default:a(()=>e[18]||(e[18]=[r("svg",{class:"type-icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-lunbotu"})],-1)])),_:2},1032,["onClick"])]),_:2},1024)):(d(),v(w,{key:1,class:"box-item",effect:"dark",content:"设置为轮播图商品",placement:"top"},{default:a(()=>[t(u,{onClick:f=>A(l.row.id,1),link:""},{default:a(()=>e[19]||(e[19]=[r("svg",{class:"type-icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-lunbotu1"})],-1)])),_:2},1032,["onClick"])]),_:2},1024)),l.row.isHot?(d(),v(w,{key:2,class:"box-item",effect:"dark",content:"取消作为热门商品",placement:"top"},{default:a(()=>[t(u,{onClick:f=>F(l.row.id,2),link:""},{default:a(()=>e[20]||(e[20]=[r("svg",{class:"type-icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-remenshangpin"})],-1)])),_:2},1032,["onClick"])]),_:2},1024)):(d(),v(w,{key:3,class:"box-item",effect:"dark",content:"设置为热门商品",placement:"top"},{default:a(()=>[t(u,{onClick:f=>A(l.row.id,2),link:""},{default:a(()=>e[21]||(e[21]=[r("svg",{class:"type-icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-remenshangpin1"})],-1)])),_:2},1032,["onClick"])]),_:2},1024)),l.row.isNew?(d(),v(w,{key:4,class:"box-item",effect:"dark",content:"取消作为新商品",placement:"top"},{default:a(()=>[t(u,{onClick:f=>F(l.row.id,3),link:""},{default:a(()=>e[22]||(e[22]=[r("svg",{class:"type-icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-xinpin1"})],-1)])),_:2},1032,["onClick"])]),_:2},1024)):(d(),v(w,{key:5,class:"box-item",effect:"dark",content:"设置为新商品",placement:"top"},{default:a(()=>[t(u,{onClick:f=>A(l.row.id,3),link:""},{default:a(()=>e[23]||(e[23]=[r("svg",{class:"type-icon","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-xinpin"})],-1)])),_:2},1032,["onClick"])]),_:2},1024))]),_:1}),t(m,{label:"操作",width:"220"},{default:a(l=>[t(u,{type:l.row.status===1?"danger":"success",size:"small",link:"",onClick:f=>ne(l.row.id,l.row.status===1?0:1)},{default:a(()=>[g(z(l.row.status===1?"下架":"上架"),1)]),_:2},1032,["type","onClick"]),t(u,{size:"small",type:"primary",onClick:f=>Y(l.row),link:""},{default:a(()=>e[24]||(e[24]=[g("编辑")])),_:2},1032,["onClick"]),t(u,{size:"small",type:"danger",onClick:f=>le(l.row.id),link:""},{default:a(()=>e[25]||(e[25]=[g("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),r("div",ze,[t(ce,{"current-page":$.value,"onUpdate:currentPage":e[4]||(e[4]=l=>$.value=l),"page-size":B.value,"onUpdate:pageSize":e[5]||(e[5]=l=>B.value=l),"page-sizes":[20,40,60,80,100],layout:"total, sizes, prev, pager, next, jumper",total:x(R),onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])]),t(_e,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=l=>k.value=l),width:"600px",title:U.value?"编辑商品":"添加商品"},{default:a(()=>[t(N,{model:o.value,"label-width":"100px",rules:X.value,ref_key:"productFormRef",ref:q},{default:a(()=>[t(c,{label:"商品名称",prop:"name"},{default:a(()=>[t(T,{modelValue:o.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.name=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),t(c,{label:"商品图片"},{default:a(()=>[t(ve,{class:"product-uploader","http-request":se,"show-file-list":!1,"before-upload":re},{default:a(()=>[o.value.imageUrl?(d(),V("img",{key:0,src:o.value.imageUrl,class:"uploaded-image"},null,8,Se)):(d(),v(fe,{key:1,class:"product-uploader-icon"},{default:a(()=>[t(me)]),_:1}))]),_:1})]),_:1}),t(c,{label:"商品描述"},{default:a(()=>[t(T,{modelValue:o.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.description=l),placeholder:"请输入商品描述"},null,8,["modelValue"])]),_:1}),t(c,{label:"商品价格",prop:"price"},{default:a(()=>[t(E,{min:0,modelValue:o.value.price,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.price=l),placeholder:"请输入商品价格"},null,8,["modelValue"])]),_:1}),t(c,{label:"库存",prop:"stock"},{default:a(()=>[t(E,{min:1,modelValue:o.value.stock,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.stock=l),placeholder:"请输入库存"},null,8,["modelValue"])]),_:1}),t(c,{label:"商品分类",prop:"categoryId"},{default:a(()=>[t(C,{modelValue:o.value.categoryId,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.categoryId=l),placeholder:"请选择分类"},{default:a(()=>[(d(!0),V(h,null,I(x(S),l=>(d(),v(b,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"商品规格"},{default:a(()=>[t(C,{modelValue:o.value.specIds,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.specIds=l),placeholder:"请选择规格",multiple:"",clearable:""},{default:a(()=>[(d(!0),V(h,null,I(x(L),l=>(d(),v(b,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"状态",prop:"status"},{default:a(()=>[t(ge,{modelValue:o.value.status,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.status=l)},{default:a(()=>[t(M,{value:1},{default:a(()=>e[26]||(e[26]=[g("上架")])),_:1}),t(M,{value:0},{default:a(()=>e[27]||(e[27]=[g("下架")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),r("div",$e,[t(u,{onClick:e[13]||(e[13]=l=>k.value=!1)},{default:a(()=>e[28]||(e[28]=[g("取消")])),_:1}),t(u,{type:"primary",onClick:e[14]||(e[14]=l=>ee(q.value))},{default:a(()=>e[29]||(e[29]=[g("保存")])),_:1})])]),_:1},8,["modelValue","title"])]),_:1})}}}),He=Pe(Be,[["__scopeId","data-v-1ec9c417"]]);export{He as default};
