import{b as L}from"./element-china-area-data-BVDNhPol.js";import{u as O}from"./http-Bo0dlXKR.js";import{u as G}from"./useUser-aX2g__mo.js";import{u as H}from"./useUpload-DJmHiEKQ.js";import{d as J,e as c,i as K,h,a as l,w as a,F as Q,r as i,k as W,o as k,b as o,u as s,p as X,c as Z,t as u,f as r,D as ee,_ as le}from"./index-CMV7StrB.js";import"./axios-BimPEqV4.js";import"./useCartItemsNumStore-BpwacNS2.js";import"./userApi-CmX0eGrO.js";import"./httpAdmin-C6IWq_Ob.js";const ae={class:"card-header"},te={key:0,fit:"cover",class:"avatar"},oe={class:"card-body"},se={class:"username"},ne={class:"edit-button"},re=J({__name:"UserInfoView",setup(ie){const I=c("default"),{user:t,getUserInfo:w,updateUserInfo:M}=G(),_=c([]),g=c("");K(async()=>{await w(),_.value=t.value.address.split(" ").slice(0,3),g.value=t.value.address.split(" ")[3]});const v=c(!1),x=c(),Y=c({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:1,max:20,message:"用户名字符长度为1到20",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phone:[{min:11,max:11,message:"请输入11位手机号码",trigger:"blur"},{pattern:/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/,message:"请输入正确的手机号码"}]}),y=()=>{v.value=!1,w()},z=d=>{d&&d.validate(async e=>{e&&(t.value.address=_.value.join(" ")+" "+g.value,M(),v.value=!1)})},C=d=>{const e=Date.now()-new Date(d).getTime(),m=new Date(e);return Math.abs(m.getUTCFullYear()-1970)},{uploadAvatar:A}=H(),B=async d=>{const e=new FormData;e.append("avatarFile",d.file);const m=await A(e);m.code===1&&(t.value.avatarUrl=m.data,O().setAvatar(m.data))},F=d=>d.size/1024/1024>2?(ee.error("头像大小必须小于2MB"),!1):!0;return(d,e)=>{const m=i("Plus"),D=i("el-icon"),S=i("el-upload"),p=i("el-descriptions-item"),q=i("el-descriptions"),V=i("el-button"),N=i("el-card"),b=i("el-input"),f=i("el-form-item"),U=i("el-option"),P=i("el-select"),T=i("el-date-picker"),$=i("el-cascader"),j=i("el-form"),E=i("el-drawer"),R=W("lazy");return k(),h(Q,null,[l(N,{class:"info-card",shadow:"hover"},{default:a(()=>[o("div",ae,[l(S,{class:"avatar-uploader","http-request":B,"show-file-list":!1,"before-upload":F},{default:a(()=>[s(t).avatarUrl?X((k(),h("img",te,null,512)),[[R,s(t).avatarUrl]]):(k(),Z(D,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[l(m)]),_:1}))]),_:1})]),o("div",oe,[o("h2",se,u(s(t).username),1),l(q,{class:"margin-top",column:1,size:I.value,border:""},{default:a(()=>[l(p,null,{label:a(()=>e[10]||(e[10]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-xingbie"})]),r(" 性别 ")],-1)])),default:a(()=>[r(" "+u(s(t).gender===1?"男":s(t).gender===0?"女":""),1)]),_:1}),l(p,null,{label:a(()=>e[11]||(e[11]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-nianling"})]),r(" 年龄 ")],-1)])),default:a(()=>[r(" "+u(C(s(t).birthdate)),1)]),_:1}),l(p,null,{label:a(()=>e[12]||(e[12]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-shengritixing"})]),r(" 生日 ")],-1)])),default:a(()=>[r(" "+u(s(t).birthdate),1)]),_:1}),l(p,null,{label:a(()=>e[13]||(e[13]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-phone"})]),r(" 电话 ")],-1)])),default:a(()=>[r(" "+u(s(t).phone),1)]),_:1}),l(p,null,{label:a(()=>e[14]||(e[14]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-youxiang"})]),r(" 邮箱 ")],-1)])),default:a(()=>[r(" "+u(s(t).email),1)]),_:1}),l(p,null,{label:a(()=>e[15]||(e[15]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-dizhi"})]),r(" 地址 ")],-1)])),default:a(()=>[r(" "+u(s(t).address),1)]),_:1}),l(p,null,{label:a(()=>e[16]||(e[16]=[o("div",{class:"cell-item"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-shangcidenglushijian"})]),r(" 最后登录时间 ")],-1)])),default:a(()=>[r(" "+u(s(t).lastLogin),1)]),_:1})]),_:1},8,["size"])]),l(V,{type:"primary",class:"edit-personali-nfo-button",plain:"",onClick:e[0]||(e[0]=n=>v.value=!0)},{default:a(()=>e[17]||(e[17]=[r("修改个人信息")])),_:1})]),_:1}),l(E,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=n=>v.value=n),title:"修改基本信息","before-close":y},{default:a(()=>[l(j,{model:s(t),"label-width":"auto",style:{"max-width":"600px"},rules:Y.value,ref_key:"userRef",ref:x},{default:a(()=>[l(f,{label:"用户名",prop:"username"},{default:a(()=>[l(b,{modelValue:s(t).username,"onUpdate:modelValue":e[1]||(e[1]=n=>s(t).username=n)},null,8,["modelValue"])]),_:1}),l(f,{label:"性别"},{default:a(()=>[l(P,{modelValue:s(t).gender,"onUpdate:modelValue":e[2]||(e[2]=n=>s(t).gender=n),placeholder:"请选择你的性别"},{default:a(()=>[l(U,{label:"男",value:1}),l(U,{label:"女",value:0}),l(U,{label:"保密",value:-1})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"出生日期"},{default:a(()=>[l(T,{format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",modelValue:s(t).birthdate,"onUpdate:modelValue":e[3]||(e[3]=n=>s(t).birthdate=n),placeholder:"请选择出生日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(f,{label:"电话",prop:"phone"},{default:a(()=>[l(b,{modelValue:s(t).phone,"onUpdate:modelValue":e[4]||(e[4]=n=>s(t).phone=n)},null,8,["modelValue"])]),_:1}),l(f,{label:"邮箱",prop:"email"},{default:a(()=>[l(b,{modelValue:s(t).email,"onUpdate:modelValue":e[5]||(e[5]=n=>s(t).email=n)},null,8,["modelValue"])]),_:1}),l(f,{label:"省/市/区"},{default:a(()=>[l($,{options:s(L),modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=n=>_.value=n)},null,8,["options","modelValue"])]),_:1}),l(f,{label:"详细地址"},{default:a(()=>[l(b,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=n=>g.value=n)},null,8,["modelValue"])]),_:1}),o("div",ne,[l(V,{onClick:y},{default:a(()=>e[18]||(e[18]=[r("取消")])),_:1}),l(V,{type:"primary",onClick:e[8]||(e[8]=n=>z(x.value))},{default:a(()=>e[19]||(e[19]=[r("确定")])),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),be=le(re,[["__scopeId","data-v-f9b7b38c"]]);export{be as default};
