import{u}from"./http-Bo0dlXKR.js";import{u as d}from"./useCartItemsNumStore-BpwacNS2.js";import{u as m,a as i,e as f,g as I,b as p}from"./userApi-CmX0eGrO.js";import{e as w,D as r,g}from"./index-CMV7StrB.js";const a=u(),o=d(),t=w({id:-1,username:"",email:"",phone:"",avatarUrl:"",gender:-1,birthdate:"",address:"",lastLogin:""}),l=async s=>{s.username=s.username.replace(/(^\s*)|(\s*$)/g,""),s.password=s.password.replace(/(^\s*)|(\s*$)/g,"");const e=await m(s);return e.code===1?(r.success("登录成功"),a.setToken(e.data.token),a.setUsername(s.username),a.setAvatar(e.data.avatarUrl),o.getCartItemsNum()):r.error(e.msg),e.code},U=async s=>{const e=await i(s);return e.code===1?r.success("注册成功，请用该账号登录"):r.success(e.msg),e.code},n=()=>{a.removeTokenAndUsername(),o.removeCartItemsNum(),g.push({path:"/login",query:{isLogin:1}})},P=async s=>{const e=await f(s);e.code===1?(r.success("密码修改成功"),s={oldPassword:"",newPassword:"",confirmPassword:""},n(),r.success("请用新密码登录")):r.error(e.msg)},c=async()=>{const s=await I();if(s.code===0){r.error(s.msg);return}t.value=s.data},v=async()=>{const s=await p(t.value);s.code===0?r.error(s.msg):r.success("修改成功"),c()};function N(){return{user:t,userLogin:l,userRegister:U,logout:n,editPassword:P,getUserInfo:c,updateUserInfo:v}}export{N as u};
