import{u as J}from"./useAdmin-D4iKWU4I.js";import{u as K}from"./httpAdmin-C6IWq_Ob.js";import{d as O,e as i,i as X,h as Y,a as l,w as t,b as p,u as D,F as Z,r as o,o as y,f as c,t as ee,c as N,z as I,D as M,H as le,_ as ae}from"./index-CMV7StrB.js";import"./userApi-CmX0eGrO.js";import"./http-Bo0dlXKR.js";import"./axios-BimPEqV4.js";const te={class:"dialog-footer"},oe={class:"user-management-page"},se={class:"user-management"},ne={class:"user-pagination-block"},re=O({__name:"userView",setup(ue){const{pageQuery:r,pageQueryUser:f,users:E,totalUser:h,resetPassword:B,setRole:P}=J(),R=K(),C=i(R.role=="SUPER"),n=i({username:"",role:"ALL"}),g=i(1),_=i(10),V=()=>{r.value.page=g.value,r.value.pageSize=_.value,f()},m=i(!1),u=i(""),k=i(-1),$=s=>{k.value=s,m.value=!0},L=async s=>{if(u.value=u.value.replace(/(^\s*)|(\s*$)/g,""),!u.value||u.value.length<6){M.error("密码长度应不少于 6 个字符");return}await B(s,u.value)===1&&(m.value=!1)},U=(s,e)=>{le.confirm(`确定将该用户设置为${e==="ADMIN"?"管理员":"普通用户"}吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await P(s,e),V()}).catch(()=>{M.info("已取消")})},T=s=>{r.value.pageSize=s,f()},F=s=>{r.value.page=s,f()},S=()=>{r.value.username=n.value.username,n.value.role&&(n.value.role==="ADMIN"||n.value.role==="USER")?r.value.role=n.value.role:r.value.role=null,f()};return X(()=>{V()}),(s,e)=>{const x=o("el-input"),b=o("el-form-item"),z=o("el-form"),d=o("el-button"),Q=o("el-dialog"),w=o("el-option"),j=o("el-select"),H=o("el-card"),v=o("el-table-column"),W=o("el-tag"),q=o("el-table"),G=o("el-pagination");return y(),Y(Z,null,[l(Q,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=a=>m.value=a),title:"重置密码",width:"500",center:"",class:"reset-password-dialog"},{footer:t(()=>[p("div",te,[l(d,{onClick:e[1]||(e[1]=a=>m.value=!1),class:"cancel-btn"},{default:t(()=>e[8]||(e[8]=[c("取消")])),_:1}),l(d,{type:"primary",onClick:e[2]||(e[2]=a=>L(k.value)),class:"submit-btn"},{default:t(()=>e[9]||(e[9]=[c("重置")])),_:1})])]),default:t(()=>[l(z,{class:"reset-password-form"},{default:t(()=>[l(b,null,{default:t(()=>[l(x,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),class:"password-input",type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),p("div",oe,[l(H,{class:"search-filter-card",shadow:"hover"},{default:t(()=>[l(z,{inline:!0,"label-width":"80px",class:"filter-form"},{default:t(()=>[l(b,{label:"用户名",class:"filter-item"},{default:t(()=>[l(x,{modelValue:n.value.username,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.username=a),placeholder:"请输入用户名",clearable:"",class:"filter-input"},{append:t(()=>[l(d,{class:"search-btn",onClick:S},{default:t(()=>e[10]||(e[10]=[p("svg",{class:"icon","aria-hidden":"true"},[p("use",{"xlink:href":"#icon-find"})],-1)])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"用户角色",class:"filter-item"},{default:t(()=>[l(j,{modelValue:n.value.role,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.role=a),placeholder:"请选择角色",onChange:S,class:"role-select"},{default:t(()=>[l(w,{label:"全部",value:"ALL"}),l(w,{label:"普通用户",value:"USER"}),l(w,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),p("div",se,[l(q,{data:D(E),stripe:"",border:"","header-cell-style":{"text-align":"center",background:"#f0f0f5",fontWeight:"bold",color:"#333"},"cell-style":{"text-align":"center"},class:"user-table"},{default:t(()=>[l(v,{type:"index",label:"序号",width:"60"}),l(v,{prop:"username",label:"用户名"}),l(v,{prop:"role",label:"角色"},{default:t(a=>[l(W,{type:a.row.role==="ADMIN"?"success":"info"},{default:t(()=>[c(ee(a.row.role==="ADMIN"?"管理员":"用户"),1)]),_:2},1032,["type"])]),_:1}),l(v,{label:"操作",width:"220"},{default:t(a=>[l(d,{type:"danger",size:"small",onClick:A=>$(a.row.id),class:"action-button"},{default:t(()=>e[11]||(e[11]=[c("重置密码")])),_:2},1032,["onClick"]),C.value&&a.row.role==="USER"?(y(),N(d,{key:0,type:"warning",size:"small",class:"action-button",onClick:A=>U(a.row.id,"ADMIN")},{default:t(()=>e[12]||(e[12]=[c(" 设为管理员 ")])),_:2},1032,["onClick"])):I("",!0),C.value&&a.row.role==="ADMIN"?(y(),N(d,{key:1,type:"primary",size:"small",class:"action-button",onClick:A=>U(a.row.id,"USER")},{default:t(()=>e[13]||(e[13]=[c(" 设为普通用户 ")])),_:2},1032,["onClick"])):I("",!0)]),_:1})]),_:1},8,["data"])]),p("div",ne,[l(G,{"current-page":g.value,"onUpdate:currentPage":e[6]||(e[6]=a=>g.value=a),"page-size":_.value,"onUpdate:pageSize":e[7]||(e[7]=a=>_.value=a),"page-sizes":[10,20,40,60,100],layout:"total, sizes, prev, pager, next, jumper",total:D(h),onSizeChange:T,onCurrentChange:F},null,8,["current-page","page-size","total"])])])],64)}}}),ve=ae(re,[["__scopeId","data-v-9957583e"]]);export{ve as default};
